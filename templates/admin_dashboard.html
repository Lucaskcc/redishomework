<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†å“¡å¾Œå°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .container {
            max-width: 1200px;
            margin-top: 30px;
        }
        .slot-section {
            border: 1px solid #ccc;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            background-color: #f8f8f8;
        }
        .status-badge {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: bold;
            margin-right: 15px;
            color: white; 
        }
        .open { background-color: #28a745; }
        .closed { background-color: #dc3545; }
        .full { background-color: #ffc107; } 
    </style>
</head>
<body class="bg-light">
    <div class="container bg-white p-4 rounded shadow">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="text-primary mb-0">ğŸ› ï¸ å¾Œå°ç®¡ç†å„€è¡¨æ¿</h1>
            <div>
                <a href="{{ url_for('admin_add_slot') }}" class="btn btn-success me-2">ğŸ†• æ–°å¢ç­åˆ¥</a>
                <a class="btn btn-sm btn-outline-secondary me-2" href="{{ url_for('admin_account') }}">
                    ğŸ‘¤ å¸³è™Ÿ ({{ user_role | upper }})
                </a>
                <a href="{{ url_for('admin_logout') }}" class="btn btn-danger">ç™»å‡º</a>
            </div>
        </div>

        {% if user_role != 'super' %}
        <div class="alert alert-warning text-center">
            æ‚¨ç›®å‰æ˜¯ **æŸ¥çœ‹è€… (VIEWER)** æ¬Šé™ï¼Œç„¡æ³•é€²è¡Œæ–°å¢ã€ç·¨è¼¯æˆ–åˆªé™¤æ“ä½œã€‚
        </div>
        {% endif %}

        {% for slot in slots %}
        <div class="slot-section shadow-sm">
            <div class="d-flex justify-content-between align-items-start mb-3">
                
                <h3 class="mb-0">
                    <span class="text-secondary">{{ slot.work_date }}</span> - <strong class="text-dark">{{ slot.slot_name }}</strong>
                </h3>
                
                <div class="text-end">
                    {% set status = 'é–‹æ”¾ä¸­' if slot.is_open else 'å·²é—œé–‰' %}
                    {% set badge_class = 'open' if slot.is_open else 'closed' %}
                    {% set is_full = slot.current_bookings >= slot.capacity %}

                    {% if is_full %}
                        <span class="status-badge full">äººæ•¸å·²æ»¿</span>
                    {% else %}
                        <span class="status-badge {{ badge_class }}">{{ status }}</span>
                    {% endif %}

                    <a href="{{ url_for('admin_edit_slot', slot_id=slot.id) }}" class="btn btn-sm btn-primary ms-3">
                        {% if user_role == 'super' %}
                            âœï¸ ç·¨è¼¯
                        {% else %}
                            â„¹ï¸ æŸ¥çœ‹
                        {% endif %}
                    </a>
                </div>
            </div>

            <p class="fs-5 fw-bold text-muted mb-2">
                å ±åäººæ•¸ï¼š<span class="text-dark">{{ slot.current_bookings }}</span> / {{ slot.capacity }} äºº
            </p>

            {% if slot.bookings %}
                <h5 class="text-primary mt-3">âœ… æœ€æ–°å ±å (å‰ 3 ç­†)</h5>
                <div class="table-responsive">
                    <table class="table table-bordered table-striped">
                        <thead class="table-light">
                            <tr>
                                <th style="width: 5%;">#</th>
                                <th style="width: 25%;">å§“å</th>
                                <th style="width: 20%;">èº«åˆ†è­‰å¾Œå››ç¢¼</th>
                                <th style="width: 50%;">å ±åæ™‚é–“</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for person in slot.bookings[:3] %}
                            <tr>
                                <td>{{ loop.index }}</td>
                                <td>{{ person.name }}</td>
                                <td>{{ person.id_last_4 }}</td>
                                <td>{{ person.booking_time }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="text-end">
                    <a href="{{ url_for('admin_view_bookings', slot_id=slot.id) }}" class="btn btn-sm btn-info text-white">
                        {{ 'æŸ¥çœ‹å®Œæ•´åå–®' if slot.bookings | length > 3 else 'æŸ¥çœ‹åå–®' }}
                    </a>
                </div>
            {% else %}
                <p class="text-muted fst-italic pt-2 mb-0">ç›®å‰ç„¡äººå ±åæ­¤ç­åˆ¥ã€‚</p>
            {% endif %}

        </div>
        {% endfor %}
        
        {% if not slots %}
        <div class="alert alert-info text-center">ç›®å‰æ²’æœ‰ä»»ä½•ç­åˆ¥è³‡æ–™ã€‚è«‹é»æ“Šã€Œæ–°å¢ç­åˆ¥ã€å‰µå»ºç¬¬ä¸€å€‹ç­åˆ¥ã€‚</div>
        {% endif %}
    </div>
</body>
</html>