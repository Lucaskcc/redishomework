<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†å“¡å¾Œå°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .container {
            max-width: 1200px;
            margin-top: 30px;
        }
        .slot-section {
            border: 1px solid #ccc;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            background-color: #f8f8f8;
        }
        .status-badge {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: bold;
            margin-right: 15px;
            color: white; 
        }
        .open { background-color: #28a745; }
        .closed { background-color: #dc3545; }
        .full { background-color: #ffc107; } 
    </style>
</head>
<body class="bg-light">
    <div class="container bg-white p-4 rounded shadow">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="text-primary">ğŸ› ï¸ ç®¡ç†å„€è¡¨æ¿</h1>
            <div>
                <a href="{{ url_for('admin_new_slot') }}" class="btn btn-success me-2">æ–°å¢ç­åˆ¥</a>
                <a href="{{ url_for('admin_logout') }}" class="btn btn-outline-danger">ç™»å‡º ({{ session.username }})</a>
            </div>
        </div>

        {% for slot in slots %}
        <div class="slot-section">
            <div class="d-flex justify-content-between align-items-center mb-2">
                {% set status_class = 'open' if slot.is_open and slot.count < slot.capacity else ('closed' if not slot.is_open else 'full') %}
                {% set status_text = 'é–‹æ”¾å ±å' if slot.is_open and slot.count < slot.capacity else ('å·²é—œé–‰' if not slot.is_open else 'åé¡å·²æ»¿') %}
                <span class="status-badge {{ status_class }}">{{ status_text }}</span>

                <h3 class="h5 mb-0 text-dark me-auto">
                    {{ slot.work_date }} - {{ slot.slot_name }}
                </h3>
                
                <div class="btn-group">
                    <a href="{{ url_for('admin_view_bookings', slot_id=slot.id) }}" class="btn btn-info btn-sm">
                        æŸ¥çœ‹åå–® ({{ slot.count }} / {{ slot.capacity }})
                    </a>
                    {% if user_role == 'super' %}
                    <a href="{{ url_for('admin_edit_slot', slot_id=slot.id) }}" class="btn btn-warning btn-sm">ç·¨è¼¯/åˆªé™¤</a>
                    {% endif %}
                </div>
            </div>

            {% if slot.bookings %}
                <p class="text-secondary small mb-1 mt-2">è¿‘æœŸå ±åï¼š</p>
                <div class="table-responsive">
                    <table class="table table-sm table-bordered table-striped">
                        <thead class="table-light">
                            <tr>
                                <th style="width: 5%;">#</th>
                                <th style="width: 25%;">å§“å</th>
                                <th style="width: 20%;">èº«åˆ†è­‰å¾Œå››ç¢¼</th>
                                <th style="width: 50%;">å ±åæ™‚é–“</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for person in slot.bookings %}
                            <tr>
                                <td>{{ loop.index }}</td>
                                <td>{{ person.name }}</td>
                                <td>{{ person.id_last_4 }}</td>
                                <td>{{ person.booking_time }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% if slot.bookings | length > 3 %}
                <p class="text-end small text-primary mb-0">...é‚„æœ‰ {{ slot.bookings | length - 3 }} ç­†å ±åï¼Œè«‹é»æ“Šã€ŒæŸ¥çœ‹åå–®ã€</p>
                {% endif %}
            {% else %}
                <p class="text-muted fst-italic pt-2 mb-0">ç›®å‰ç„¡äººå ±åæ­¤ç­åˆ¥ã€‚</p>
            {% endif %}

        </div>
        {% endfor %}
        
        {% if not slots %}
        <div class="alert alert-info text-center">ç›®å‰æ²’æœ‰ä»»ä½•ç­åˆ¥è³‡æ–™ã€‚è«‹é»æ“Šã€Œæ–°å¢ç­åˆ¥ã€å‰µå»ºç¬¬ä¸€å€‹ç­åˆ¥ã€‚</div>
        {% endif %}
    </div>
</body>
</html>